{"version":3,"file":"index-88d8d263.js","sources":["../../../src/pages/list/card/components/dialog-form.vue","../../../src/pages/list/card/index.vue"],"sourcesContent":["<template>\n  <t-dialog\n    v-model:visible=\"formVisible\"\n    header=\"新建产品\"\n    :width=\"680\"\n    :footer=\"false\"\n  >\n    <template #body>\n      <!-- 表单内容 -->\n      <t-form\n        ref=\"form\"\n        :data=\"formData\"\n        :rules=\"rules\"\n        :label-width=\"100\"\n        @submit=\"onSubmit\"\n      >\n        <t-form-item\n          label=\"产品名称\"\n          name=\"name\"\n        >\n          <t-input\n            v-model=\"formData.name\"\n            :style=\"{ width: '480px' }\"\n            placeholder=\"请输入产品名称\"\n          />\n        </t-form-item>\n        <t-form-item\n          label=\"产品状态\"\n          name=\"status\"\n        >\n          <t-radio-group v-model=\"formData.status\">\n            <t-radio value=\"0\">已停用</t-radio>\n            <t-radio value=\"1\">已启用</t-radio>\n          </t-radio-group>\n        </t-form-item>\n        <t-form-item\n          label=\"产品描述\"\n          name=\"description\"\n        >\n          <t-input\n            v-model=\"formData.description\"\n            :style=\"{ width: '480px' }\"\n            placeholder=\"请输入产品描述\"\n          />\n        </t-form-item>\n        <t-form-item\n          label=\"产品类型\"\n          name=\"type\"\n        >\n          <t-select\n            v-model=\"formData.type\"\n            clearable\n            :style=\"{ width: '480px' }\"\n          >\n            <t-option\n              v-for=\"(item, index) in SELECT_OPTIONS\"\n              :key=\"index\"\n              :value=\"item.value\"\n              :label=\"item.label\"\n            >\n              {{ item.label }}\n            </t-option>\n          </t-select>\n        </t-form-item>\n        <t-form-item\n          label=\"备注\"\n          name=\"mark\"\n        >\n          <t-textarea\n            v-model=\"textareaValue\"\n            :style=\"{ width: '480px' }\"\n            placeholder=\"请输入内容\"\n            name=\"description\"\n          />\n        </t-form-item>\n        <t-form-item style=\"float: right\">\n          <t-button\n            variant=\"outline\"\n            @click=\"onClickCloseBtn\"\n          >\n            取消\n          </t-button>\n          <t-button\n            theme=\"primary\"\n            type=\"submit\"\n          >\n            确定\n          </t-button>\n        </t-form-item>\n      </t-form>\n    </template>\n  </t-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { MessagePlugin } from 'tdesign-vue-next';\n\nconst INITIAL_DATA = {\n  name: '',\n  status: '',\n  description: '',\n  type: '',\n  mark: '',\n  amount: 0\n};\n\nconst SELECT_OPTIONS = [\n  { label: '网关', value: '1' },\n  { label: '人工智能', value: '2' },\n  { label: 'CVM', value: '3' }\n];\n\nconst props = defineProps({\n  visible: {\n    type: Boolean,\n    default: false\n  },\n  data: {\n    type: Object,\n    default: () => {\n      return {};\n    }\n  }\n});\n\nconst formVisible = ref(false);\nconst formData = ref(props.data);\nconst textareaValue = ref('');\n\nconst onSubmit = ({ result, firstError }) => {\n  if (!firstError) {\n    MessagePlugin.success('提交成功');\n    formVisible.value = false;\n  } else {\n    console.log('Errors: ', result);\n    MessagePlugin.warning(firstError);\n  }\n};\n\nconst onClickCloseBtn = () => {\n  formVisible.value = false;\n  formData.value = { ...INITIAL_DATA };\n};\n\nconst emit = defineEmits(['update:visible']);\nwatch(\n  () => formVisible.value,\n  val => {\n    emit('update:visible', val);\n  }\n);\n\nwatch(\n  () => props.visible,\n  val => {\n    formVisible.value = val;\n  }\n);\n\nwatch(\n  () => props.data,\n  val => {\n    formData.value = val;\n  }\n);\n\nconst rules = {\n  name: [{ required: true, message: '请输入产品名称', type: 'error' }]\n};\n</script>\n","<template>\n  <div>\n    <div class=\"list-card-operation\">\n      <t-button @click=\"formDialogVisible = true\">新建产品</t-button>\n      <div class=\"search-input\">\n        <t-input\n          v-model=\"searchValue\"\n          placeholder=\"请输入你需要搜索的内容\"\n          clearable\n        >\n          <template #suffix-icon>\n            <search-icon\n              v-if=\"searchValue === ''\"\n              size=\"20px\"\n            />\n          </template>\n        </t-input>\n      </div>\n    </div>\n\n    <dialog-form\n      v-model:visible=\"formDialogVisible\"\n      :data=\"formData\"\n    />\n\n    <template v-if=\"pagination.total > 0 && !dataLoading\">\n      <div class=\"list-card-items\">\n        <t-row :gutter=\"[16, 12]\">\n          <t-col\n            v-for=\"product in productList.slice(\n              pagination.pageSize * (pagination.current - 1),\n              pagination.pageSize * pagination.current\n            )\"\n            :key=\"product.index\"\n            :lg=\"4\"\n            :xs=\"6\"\n            :xl=\"3\"\n          >\n            <product-card\n              class=\"list-card-item\"\n              :product=\"product\"\n              @delete-item=\"handleDeleteItem\"\n              @manage-product=\"handleManageProduct\"\n            />\n          </t-col>\n        </t-row>\n      </div>\n      <div class=\"list-card-pagination\">\n        <t-pagination\n          v-model=\"pagination.current\"\n          v-model:page-size=\"pagination.pageSize\"\n          :total=\"pagination.total\"\n          :page-size-options=\"[12, 24, 36]\"\n          @page-size-change=\"onPageSizeChange\"\n          @current-change=\"onCurrentChange\"\n        />\n      </div>\n    </template>\n\n    <div\n      v-else-if=\"dataLoading\"\n      class=\"list-card-loading\"\n    >\n      <t-loading\n        size=\"large\"\n        text=\"加载数据中...\"\n      />\n    </div>\n\n    <t-dialog\n      v-model:visible=\"confirmVisible\"\n      header=\"确认删除所选产品？\"\n      :body=\"confirmBody\"\n      :on-cancel=\"onCancel\"\n      @confirm=\"onConfirmDelete\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'ListCard'\n};\n</script>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue';\nimport { SearchIcon } from 'tdesign-icons-vue-next';\nimport { MessagePlugin } from 'tdesign-vue-next';\nimport ProductCard from '@/components/product-card/index.vue';\nimport DialogForm from './components/dialog-form.vue';\nimport { getCardList } from '@/api/list';\n\nconst INITIAL_DATA = {\n  name: '',\n  status: '',\n  description: '',\n  type: '',\n  mark: '',\n  amount: 0\n};\n\nconst pagination = ref({ current: 1, pageSize: 12, total: 0 });\nconst deleteProduct = ref(undefined);\n\nconst productList = ref([]);\nconst dataLoading = ref(true);\n\nconst fetchData = async () => {\n  try {\n    const { list } = await getCardList();\n    productList.value = list;\n    pagination.value = {\n      ...pagination.value,\n      total: list.length\n    };\n  } catch (e) {\n    console.log(e);\n  } finally {\n    dataLoading.value = false;\n  }\n};\n\nconst confirmBody = computed(() =>\n  deleteProduct.value\n    ? `确认删除后${deleteProduct.value.name}的所有产品信息将被清空, 且无法恢复`\n    : ''\n);\n\nonMounted(() => {\n  fetchData();\n});\n\nconst formDialogVisible = ref(false);\nconst searchValue = ref('');\nconst confirmVisible = ref(false);\nconst formData = ref({ ...INITIAL_DATA });\n\nconst onPageSizeChange = (size: number) => {\n  pagination.value.pageSize = size;\n  pagination.value.current = 1;\n};\nconst onCurrentChange = (current: number) => {\n  pagination.value.current = current;\n};\nconst handleDeleteItem = product => {\n  confirmVisible.value = true;\n  deleteProduct.value = product;\n};\nconst onConfirmDelete = () => {\n  const { index } = deleteProduct.value;\n  productList.value.splice(index - 1, 1);\n  confirmVisible.value = false;\n  MessagePlugin.success('删除成功');\n};\nconst onCancel = () => {\n  deleteProduct.value = undefined;\n  formData.value = { ...INITIAL_DATA };\n};\nconst handleManageProduct = product => {\n  formDialogVisible.value = true;\n  formData.value = { ...product, status: product?.isSetup ? '1' : '0' };\n};\n</script>\n\n<style lang=\"less\" scoped>\n.list-card {\n  height: 100%;\n  &-operation {\n    display: flex;\n    justify-content: space-between;\n    .search-input {\n      width: 360px;\n    }\n  }\n  &-items {\n    margin-top: 14px;\n    margin-bottom: 24px;\n  }\n  &-pagination {\n    padding: 16px;\n  }\n  &-loading {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    align-items: center;\n    justify-content: center;\n  }\n}\n</style>\n"],"names":["INITIAL_DATA","name","status","description","type","mark","amount","SELECT_OPTIONS","label","value","formVisible","ref","formData","props","data","textareaValue","onSubmit","result","firstError","MessagePlugin","warning","success","onClickCloseBtn","__spreadValues","watch","val","emit","visible","rules","required","message","pagination","current","pageSize","total","deleteProduct","productList","dataLoading","fetchData","__async","this","list","getCardList","__spreadProps","length","e","confirmBody","computed","onMounted","formDialogVisible","searchValue","confirmVisible","onPageSizeChange","size","onCurrentChange","handleDeleteItem","product","onConfirmDelete","index","splice","onCancel","handleManageProduct","isSetup"],"mappings":"u/BAiGAA,EAAA,CAAqBC,KAAA,GACbC,OAAA,GACEC,YAAA,GACKC,KAAA,GACPC,KAAA,GACAC,OAAA,GAIRC,EAAA,CAAuB,CAAAC,MAAA,KAAAC,MAAA,KACK,CAAAD,MAAA,OAAAC,MAAA,KACE,CAAAD,MAAA,MAAAC,MAAA,MAiB9BC,EAAAC,GAAA,GACAC,EAAAD,EAAAE,EAAAC,MACAC,EAAAJ,EAAA,IAEAK,EAAA,EAAAC,OAAAA,EAAAC,WAAAA,MACEA,EAKEC,EAAAC,QAAAF,IAJAC,EAAAE,QAAA,QACAX,EAAAD,OAAA,IAOJa,EAAA,KACEZ,EAAAD,OAAA,EACAG,EAAAH,MAAAc,EAAA,GAAAvB,IAIFwB,EAAA,IAAAd,EAAAD,MACoBgB,IAEhBC,EAAA,iBAAAD,KAIJD,EAAA,IAAAX,EAAAc,QACcF,IAEVf,EAAAD,MAAAgB,IAIJD,EAAA,IAAAX,EAAAC,KACcW,IAEVb,EAAAH,MAAAgB,IAIJ,MAAAG,EAAA,CAAc3B,KAAA,CAAA,CAAA4B,UAAA,EAAAC,QAAA,UAAA1B,KAAA,o5DCtFd,CAAeH,KAAA,uBAaf,MAAAD,EAAA,CAAqBC,KAAA,GACbC,OAAA,GACEC,YAAA,GACKC,KAAA,GACPC,KAAA,GACAC,OAAA,GAIRyB,EAAApB,EAAA,CAAAqB,QAAA,EAAAC,SAAA,GAAAC,MAAA,IACAC,EAAAxB,OAAA,GAEAyB,EAAAzB,EAAA,IACA0B,EAAA1B,GAAA,GAEA2B,EAAA,KAAAC,SAAAC,OAAA,OAAA,YACE,IACE,MAAAC,KAAAA,SAAAC,IACAN,EAAA3B,MAAAgC,EACAV,EAAAtB,MAAAkC,EAAmBpB,EAAA,GAAAQ,EAAAtB,OAAnB,CACgByB,MAAAO,EAAAG,eAEhBC,IAEa,QAEbR,EAAA5B,OAAA,6MAIJqC,EAAAC,EAAoB,IAAAZ,EAAA1B,MAAA,QAAA0B,EAAA1B,MAAAR,yBAAA,IAMpB+C,EAAA,WAIA,MAAAC,EAAAtC,GAAA,GACAuC,EAAAvC,EAAA,IACAwC,EAAAxC,GAAA,GACAC,EAAAD,EAAAY,EAAA,GAAAvB,IAEAoD,EAAAC,IACEtB,EAAAtB,MAAAwB,SAAAoB,EACAtB,EAAAtB,MAAAuB,QAAA,GAEFsB,EAAAtB,IACED,EAAAtB,MAAAuB,QAAAA,GAEFuB,EAAAC,IACEL,EAAA1C,OAAA,EACA0B,EAAA1B,MAAA+C,GAEFC,EAAA,KACE,MAAAC,MAAAA,GAAAvB,EAAA1B,MACA2B,EAAA3B,MAAAkD,OAAAD,EAAA,EAAA,GACAP,EAAA1C,OAAA,EACAU,EAAAE,QAAA,SAEFuC,EAAA,KACEzB,EAAA1B,WAAA,EACAG,EAAAH,MAAAc,EAAA,GAAAvB,IAEF6D,EAAAL,IACEP,EAAAxC,OAAA,EACAG,EAAAH,MAAAkC,OAAAa,GAAA,CAAAtD,QAAA,MAAAsD,OAAA,EAAAA,EAAAM,SAAA,IAAA"}