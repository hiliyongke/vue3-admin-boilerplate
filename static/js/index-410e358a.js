import{d as e,g as t,k as l,h as a,c as n,a as o,n as i,ad as u,o as d,e as r,l as c,x as s,R as v,G as h}from"./.pnpm-baced213.js";import{_ as g}from"./_plugin-vue_export-helper-1b428a4d.js";const m=e({name:"CanvasSign",props:{width:{type:Number,default:document.documentElement.clientWidth||document.body.clientWidth},height:{type:Number,default:200},lineWidth:{type:Number,default:2},color:{type:String,default:"#000"},backgroundColor:{type:String,default:"rgba(255, 255, 255, 0)"},borderWidth:{type:Number,default:1},borderColor:{type:String,default:"#333"},imageType:{type:String,default:"image/png",validator:e=>["image/png","image/jpeg","image/webp"].includes(e)},imageQual:{type:Number,default:.92,validator:e=>e<=1&&e>=0}},setup(e){const n=t(),o=t(),i=t(!1),u=l(()=>e.borderWidth>0&&e.width>2*e.borderWidth?`border: ${e.borderWidth}px solid ${e.borderColor}`:""),d=()=>{const t=o.value;if(t){const{backgroundColor:l,color:a,lineWidth:o}=e,{width:i,height:u}=n.value||{};t.fillStyle=l,t.fillRect(0,0,i||0,u||0),t.strokeStyle=a,t.lineWidth=o,t.lineCap="round",t.lineJoin="round",t.shadowBlur=1,t.shadowColor=a}};return a(()=>{var e;const t=null==(e=n.value)?void 0:e.getContext("2d");t&&(o.value=t,d())}),{canvas:n,borderStyle:u,save:t=>{if(!n.value)return void t();let l;l="image/jpeg"===e.imageType?n.value.toDataURL("image/jpeg",e.imageQual):n.value.toDataURL(e.imageType),t(l)},clear:()=>{const{backgroundColor:t}=e,{width:l,height:a}=n.value||{};o.value&&(o.value.clearRect(0,0,l||0,a||0),o.value.fillStyle=t,o.value.fillRect(0,0,l||0,a||0))},reset:()=>{const t=o.value;if(t){const{width:l,height:a,borderWidth:n}=e;t.canvas.width=l>2*n?l-2*n:l,t.canvas.height=a,setTimeout(d,0)}},touchstart:e=>{var t,l,a;const{clientX:i,clientY:u,target:d}=e.changedTouches[0];if("CANVAS"===d.tagName){const{left:e,top:d}=(null==(t=n.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};null==(l=o.value)||l.beginPath(),null==(a=o.value)||a.moveTo(i-e,u-d)}},mousedown:e=>{var t,l,a;if("CANVAS"===e.target.tagName){const{left:u,top:d}=(null==(t=n.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};i.value=!0,null==(l=o.value)||l.beginPath(),null==(a=o.value)||a.moveTo(e.clientX-u,e.clientY-d)}},touchmove:e=>{var t;if(e.stopPropagation(),e.preventDefault(),!o.value)return;const{clientX:l,clientY:a,target:i}=e.changedTouches[0];if("CANVAS"===i.tagName){const{left:e,top:i}=(null==(t=n.value)?void 0:t.getBoundingClientRect())||{left:0,top:0};o.value.lineTo(l-e,a-i),o.value.stroke()}},mousemove:t=>{if(t.stopPropagation(),t.preventDefault(),i.value&&n.value&&o.value&&"CANVAS"===t.target.tagName){const{width:l,height:a}=n.value,{left:u,top:d}=n.value.getBoundingClientRect()||{left:0,top:0};o.value.lineTo(t.clientX-u,t.clientY-d),o.value.stroke(),(t.clientX-u<=e.borderWidth||t.clientX-u>=(l||0)-2*e.borderWidth||t.clientY-d<=e.borderWidth||t.clientY-d>=(a||0)-2*e.borderWidth)&&(i.value=!1)}},touchend:()=>{var e;null==(e=o.value)||e.closePath()},mouseup:()=>{var e;i.value=!1,null==(e=o.value)||e.closePath()}}}}),p=["width","height"];const f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",A=e({components:{CanvasSign:g(m,[["render",function(e,t,l,a,r,c){return d(),n("div",null,[o("canvas",{ref:"canvas",width:e.width>2*e.borderWidth?e.width-2*e.borderWidth:e.width,height:e.height,style:i(e.borderStyle),onTouchstart:t[0]||(t[0]=(...t)=>e.touchstart&&e.touchstart(...t)),onMousedown:t[1]||(t[1]=(...t)=>e.mousedown&&e.mousedown(...t)),onTouchmove:t[2]||(t[2]=(...t)=>e.touchmove&&e.touchmove(...t)),onMousemove:t[3]||(t[3]=(...t)=>e.mousemove&&e.mousemove(...t)),onTouchend:t[4]||(t[4]=(...t)=>e.touchend&&e.touchend(...t)),onMouseup:t[5]||(t[5]=(...t)=>e.mouseup&&e.mouseup(...t))},null,44,p),u(e.$slots,"default",{save:e.save,clear:e.clear})])}]])},setup(){const e=t(f),l=t(),n=t(),o=t(document.documentElement.clientWidth||document.body.clientWidth),i=t(10);return a(()=>{window.onresize=()=>{var e,t;const a=document.documentElement.clientWidth||document.body.clientWidth;o.value=a,i.value=a/100,null==(e=l.value)||e.reset(),null==(t=n.value)||t.reset()}}),{width:o,lineWidth:i,canvasSign:l,canvasSign2:n,imgSrc:e,saveCallback:t=>{e.value=t||f},saveHandle:()=>{var t;null==(t=l.value)||t.save(t=>{e.value=t||f})},clearHandle:()=>{var t;null==(t=l.value)||t.clear(),e.value=f},clearWithSlotHandle:t=>{t&&t(),e.value=f}}}}),b=o("hr",null,null,-1),w=o("hr",null,null,-1),C=["src"];const S=g(A,[["render",function(e,t,l,a,i,u){const g=v("CanvasSign"),m=h;return d(),n("div",null,[r(" 使用方法一 "),c(g,{ref:"canvasSign","image-type":"image/png",width:e.width,"line-width":e.lineWidth,"image-qual":.01,"background-color":"#EEE"},null,8,["width","line-width","image-qual"]),o("div",null,[c(m,{onClick:e.saveHandle},{default:s(()=>[r("save")]),_:1},8,["onClick"]),c(m,{onClick:e.clearHandle},{default:s(()=>[r("clear")]),_:1},8,["onClick"])]),b,r(" 使用方法二 "),c(g,{ref:"canvasSign2",height:400,width:e.width,"line-width":e.lineWidth},{default:s(({save:t,clear:l})=>[c(m,{onClick:()=>t(e.saveCallback)},{default:s(()=>[r("save")]),_:2},1032,["onClick"]),c(m,{onClick:()=>e.clearWithSlotHandle(l)},{default:s(()=>[r("clear")]),_:2},1032,["onClick"])]),_:1},8,["width","line-width"]),w,r(" 生成图片展示 "),o("img",{src:e.imgSrc,alt:"生成的图片"},null,8,C)])}]]);export{S as default};
//# sourceMappingURL=index-410e358a.js.map
