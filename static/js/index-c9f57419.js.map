{"version":3,"file":"index-c9f57419.js","sources":["../../../src/components/canvas-sign/index.vue","../../../src/pages/demo/sign/index.vue"],"sourcesContent":["<template>\n  <div>\n    <canvas\n      ref=\"canvas\"\n      :width=\"width > borderWidth * 2 ? width - borderWidth * 2 : width\"\n      :height=\"height\"\n      :style=\"borderStyle\"\n      @touchstart=\"touchstart\"\n      @mousedown=\"mousedown\"\n      @touchmove=\"touchmove\"\n      @mousemove=\"mousemove\"\n      @touchend=\"touchend\"\n      @mouseup=\"mouseup\"\n    ></canvas>\n    <slot\n      :save=\"save\"\n      :clear=\"clear\"\n    ></slot>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, ref } from 'vue';\n\ninterface ICanvasSignProps {\n  readonly width: number;\n  readonly height: number;\n  readonly lineWidth: number;\n  readonly color: string;\n  readonly backgroundColor: string;\n  readonly borderWidth: number;\n  readonly borderColor: string;\n  readonly imageType: string;\n  readonly imageQual: number;\n}\n\nexport default defineComponent({\n  name: 'CanvasSign',\n  props: {\n    // 画布宽\n    width: {\n      type: Number,\n      default: document.documentElement.clientWidth || document.body.clientWidth\n    },\n    // 画布高\n    height: {\n      type: Number,\n      default: 200\n    },\n    // 画线粗细\n    lineWidth: {\n      type: Number,\n      default: 2\n    },\n    // 画线颜色\n    color: {\n      type: String,\n      default: '#000'\n    },\n    // 画布背景色\n    backgroundColor: {\n      type: String,\n      default: 'rgba(255, 255, 255, 0)'\n    },\n    // 边框宽度\n    borderWidth: {\n      type: Number,\n      default: 1\n    },\n    // 边框颜色\n    borderColor: {\n      type: String,\n      default: '#333'\n    },\n    // 图片类型，默认：image/png，可选：image/jpeg（注意修改backgroundColor），image/webp（Chrome支持），其他类型均为image/png\n    imageType: {\n      type: String,\n      default: 'image/png',\n      validator(value: string) {\n        return ['image/png', 'image/jpeg', 'image/webp'].includes(value);\n      }\n    },\n    // 图片质量，当imageType为image/jpeg时生效，默认值：0.92，可选0~1之间，超出范围使用默认0.92\n    imageQual: {\n      type: Number,\n      default: 0.92,\n      validator(value: number) {\n        return value <= 1 && value >= 0;\n      }\n    }\n  },\n  setup(props: ICanvasSignProps) {\n    const canvas = ref<HTMLCanvasElement>();\n    const cxt = ref<CanvasRenderingContext2D>();\n    const isDraw = ref(false);\n\n    const borderStyle = computed(() => {\n      if (props.borderWidth > 0 && props.width > props.borderWidth * 2) {\n        return `border: ${props.borderWidth}px solid ${props.borderColor}`;\n      }\n      return '';\n    });\n\n    // 生成图片\n    const save = (callback: (imgBase64?: string) => void) => {\n      if (!canvas.value) {\n        callback();\n        return;\n      }\n      let imgBase64;\n      if (props.imageType === 'image/jpeg') {\n        imgBase64 = canvas.value.toDataURL('image/jpeg', props.imageQual);\n      } else {\n        imgBase64 = canvas.value.toDataURL(props.imageType);\n      }\n      callback(imgBase64);\n    };\n    // 清空画布\n    const clear = () => {\n      const { backgroundColor } = props;\n      const { width, height } = canvas.value || {};\n      if (cxt.value) {\n        cxt.value.clearRect(0, 0, width || 0, height || 0);\n        cxt.value.fillStyle = backgroundColor;\n        cxt.value.fillRect(0, 0, width || 0, height || 0);\n      }\n    };\n    // 属性改变后重置画布\n    const reset = () => {\n      const context = cxt.value;\n      if (context) {\n        const { width, height, borderWidth } = props;\n        context.canvas.width =\n          width > borderWidth * 2 ? width - borderWidth * 2 : width;\n        context.canvas.height = height;\n        setTimeout(init, 0);\n      }\n    };\n\n    // 初始化\n    const init = () => {\n      const context = cxt.value;\n      if (context) {\n        const { backgroundColor, color, lineWidth } = props;\n        const { width, height } = canvas.value || {};\n        // canvas context相关设置\n        context.fillStyle = backgroundColor;\n        context.fillRect(0, 0, width || 0, height || 0);\n        context.strokeStyle = color;\n        context.lineWidth = lineWidth;\n        context.lineCap = 'round'; // 线条末端添加圆形线帽，减少线条的生硬感\n        context.lineJoin = 'round'; // 线条交汇时为原型边角\n        // 利用阴影，消除锯齿\n        context.shadowBlur = 1;\n        context.shadowColor = color;\n      }\n    };\n    // 移动端触摸摁下\n    const touchstart = (e: TouchEvent) => {\n      const { clientX, clientY, target } = e.changedTouches[0];\n      if ((target as HTMLCanvasElement).tagName === 'CANVAS') {\n        const { left, top } = canvas.value?.getBoundingClientRect() || {\n          left: 0,\n          top: 0\n        };\n        cxt.value?.beginPath();\n        cxt.value?.moveTo(clientX - left, clientY - top);\n      }\n    };\n    // pc端鼠标点下\n    const mousedown = (e: MouseEvent) => {\n      if ((e.target as HTMLCanvasElement).tagName === 'CANVAS') {\n        const { left, top } = canvas.value?.getBoundingClientRect() || {\n          left: 0,\n          top: 0\n        };\n        isDraw.value = true;\n        cxt.value?.beginPath();\n        cxt.value?.moveTo(e.clientX - left, e.clientY - top);\n      }\n    };\n    // 移动端触摸滑动\n    const touchmove = (e: TouchEvent) => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (!cxt.value) return;\n      const { clientX, clientY, target } = e.changedTouches[0];\n      if ((target as HTMLCanvasElement).tagName === 'CANVAS') {\n        const { left, top } = canvas.value?.getBoundingClientRect() || {\n          left: 0,\n          top: 0\n        };\n        cxt.value.lineTo(clientX - left, clientY - top);\n        cxt.value.stroke();\n      }\n    };\n    // pc端鼠标移动\n    const mousemove = (e: MouseEvent) => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (isDraw.value && canvas.value && cxt.value) {\n        if ((e.target as HTMLCanvasElement).tagName === 'CANVAS') {\n          const { width, height } = canvas.value;\n          const { left, top } = canvas.value.getBoundingClientRect() || {\n            left: 0,\n            top: 0\n          };\n          cxt.value.lineTo(e.clientX - left, e.clientY - top);\n          cxt.value.stroke();\n          if (\n            e.clientX - left <= props.borderWidth ||\n            e.clientX - left >= (width || 0) - props.borderWidth * 2 ||\n            e.clientY - top <= props.borderWidth ||\n            e.clientY - top >= (height || 0) - props.borderWidth * 2\n          ) {\n            isDraw.value = false;\n          }\n        }\n      }\n    };\n    // 移动端触摸抬起\n    const touchend = () => {\n      cxt.value?.closePath();\n    };\n    // pc端鼠标松开\n    const mouseup = () => {\n      isDraw.value = false;\n      cxt.value?.closePath();\n    };\n\n    onMounted(() => {\n      // 获取canvas context\n      const context = canvas.value?.getContext('2d');\n      if (context) {\n        cxt.value = context;\n        init();\n      }\n    });\n\n    return {\n      canvas,\n      borderStyle,\n      save,\n      clear,\n      reset,\n      touchstart,\n      mousedown,\n      touchmove,\n      mousemove,\n      touchend,\n      mouseup\n    };\n  }\n});\n</script>\n","<template>\n  <div>\n    使用方法一\n    <CanvasSign\n      ref=\"canvasSign\"\n      image-type=\"image/png\"\n      :width=\"width\"\n      :line-width=\"lineWidth\"\n      :image-qual=\"0.01\"\n      background-color=\"#EEE\"\n    />\n    <div>\n      <t-button @click=\"saveHandle\">save</t-button>\n      <t-button @click=\"clearHandle\">clear</t-button>\n    </div>\n    <hr />\n    使用方法二\n    <CanvasSign\n      ref=\"canvasSign2\"\n      :height=\"400\"\n      :width=\"width\"\n      :line-width=\"lineWidth\"\n    >\n      <template #default=\"{ save, clear }\">\n        <t-button @click=\"() => save(saveCallback)\">save</t-button>\n        <t-button @click=\"() => clearWithSlotHandle(clear)\">clear</t-button>\n      </template>\n    </CanvasSign>\n    <hr />\n    生成图片展示\n    <img\n      :src=\"imgSrc\"\n      alt=\"生成的图片\"\n    />\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, onMounted, ref } from 'vue';\nimport CanvasSign from '@/components/canvas-sign/index.vue';\n\nconst blankimg =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\nexport default defineComponent({\n  components: { CanvasSign },\n  setup() {\n    const imgSrc = ref(blankimg);\n    const canvasSign = ref<typeof CanvasSign>();\n    const canvasSign2 = ref<typeof CanvasSign>();\n    const width = ref<number>(\n      document.documentElement.clientWidth || document.body.clientWidth\n    );\n    const lineWidth = ref<number>(10);\n\n    // slot中save方法回调\n    const saveCallback = (imgBase64?: string) => {\n      imgSrc.value = imgBase64 || blankimg;\n    };\n    // 不使用slot的save方法\n    const saveHandle = () => {\n      canvasSign.value?.save((img?: string) => {\n        imgSrc.value = img || blankimg;\n      });\n    };\n    // 不使用slot的clear方法\n    const clearHandle = () => {\n      canvasSign.value?.clear(); // 清空图片\n      imgSrc.value = blankimg; // 清空画布\n    };\n    // 使用slot的clear方法\n    const clearWithSlotHandle = (clear: () => void) => {\n      clear && clear(); // 清空画布\n      imgSrc.value = blankimg; // 清空图片\n    };\n\n    onMounted(() => {\n      window.onresize = () => {\n        const w =\n          document.documentElement.clientWidth || document.body.clientWidth;\n        width.value = w;\n        lineWidth.value = w / 100;\n        // 组件参数改变后，通过reset方法使属性生效\n        canvasSign.value?.reset();\n        canvasSign2.value?.reset();\n      };\n    });\n\n    return {\n      width,\n      lineWidth,\n      canvasSign,\n      canvasSign2,\n      imgSrc,\n      saveCallback,\n      saveHandle,\n      clearHandle,\n      clearWithSlotHandle\n    };\n  }\n});\n</script>\n"],"names":["_sfc_main$1","defineComponent","name","props","width","type","Number","default","document","documentElement","clientWidth","body","height","lineWidth","color","String","backgroundColor","borderWidth","borderColor","imageType","validator","value","includes","imageQual","[object Object]","canvas","ref","cxt","isDraw","borderStyle","computed","init","context","fillStyle","fillRect","strokeStyle","lineCap","lineJoin","shadowBlur","shadowColor","onMounted","_a","getContext","save","callback","imgBase64","toDataURL","clear","clearRect","reset","setTimeout","touchstart","e","clientX","clientY","target","changedTouches","tagName","left","top","getBoundingClientRect","_b","beginPath","_c","moveTo","mousedown","touchmove","stopPropagation","preventDefault","lineTo","stroke","mousemove","touchend","closePath","mouseup","blankimg","_sfc_main","components","CanvasSign","_createElementVNode","_ctx","style","_normalizeStyle","onTouchstart","_cache","args","onMousedown","onTouchmove","onMousemove","onTouchend","_hoisted_1","_renderSlot","$slots","imgSrc","canvasSign","canvasSign2","window","onresize","w","saveCallback","saveHandle","img","clearHandle","clearWithSlotHandle","__unplugin_components_0","_createTextVNode","_createVNode","_component_CanvasSign","image-type","line-width","image-qual","_component_t_button","onClick","_withCtx","_","_hoisted_2","src"],"mappings":"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"}