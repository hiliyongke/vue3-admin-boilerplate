{"version":3,"file":"common-table-b5b7f5cd.js","sources":["../../../src/pages/list/components/common-table.vue"],"sourcesContent":["<template>\n  <div class=\"list-common-table\">\n    <t-form\n      ref=\"form\"\n      :data=\"formData\"\n      :label-width=\"80\"\n      colon\n      :style=\"{ marginBottom: '8px' }\"\n      @reset=\"onReset\"\n      @submit=\"onSubmit\"\n    >\n      <t-row>\n        <t-col :span=\"10\">\n          <t-row :gutter=\"[16, 24]\">\n            <t-col :span=\"4\">\n              <t-form-item\n                label=\"合同名称\"\n                name=\"name\"\n              >\n                <t-input\n                  v-model=\"formData.name\"\n                  class=\"form-item-content\"\n                  type=\"search\"\n                  placeholder=\"请输入合同名称\"\n                  :style=\"{ minWidth: '134px' }\"\n                />\n              </t-form-item>\n            </t-col>\n            <t-col :span=\"4\">\n              <t-form-item\n                label=\"合同状态\"\n                name=\"status\"\n              >\n                <t-select\n                  v-model=\"formData.status\"\n                  class=\"form-item-content\"\n                  :options=\"CONTRACT_STATUS_OPTIONS\"\n                  placeholder=\"请选择合同状态\"\n                />\n              </t-form-item>\n            </t-col>\n            <t-col :span=\"4\">\n              <t-form-item\n                label=\"合同编号\"\n                name=\"no\"\n              >\n                <t-input\n                  v-model=\"formData.no\"\n                  class=\"form-item-content\"\n                  placeholder=\"请输入合同编号\"\n                  :style=\"{ minWidth: '134px' }\"\n                />\n              </t-form-item>\n            </t-col>\n            <t-col :span=\"4\">\n              <t-form-item\n                label=\"合同类型\"\n                name=\"type\"\n              >\n                <t-select\n                  v-model=\"formData.type\"\n                  style=\"display: inline-block\"\n                  class=\"form-item-content\"\n                  :options=\"CONTRACT_TYPE_OPTIONS\"\n                  placeholder=\"请选择合同类型\"\n                />\n              </t-form-item>\n            </t-col>\n          </t-row>\n        </t-col>\n\n        <t-col\n          :span=\"2\"\n          class=\"operation-container\"\n        >\n          <t-button\n            theme=\"primary\"\n            type=\"submit\"\n            :style=\"{ marginLeft: '8px' }\"\n          >\n            查询\n          </t-button>\n          <t-button\n            type=\"reset\"\n            variant=\"base\"\n            theme=\"default\"\n          >\n            重置\n          </t-button>\n        </t-col>\n      </t-row>\n    </t-form>\n\n    <div class=\"table-container\">\n      <t-table\n        :data=\"data\"\n        :columns=\"COLUMNS\"\n        :row-key=\"rowKey\"\n        :vertical-align=\"verticalAlign\"\n        :hover=\"hover\"\n        :pagination=\"pagination\"\n        :loading=\"dataLoading\"\n        :header-affixed-top=\"{ offsetTop, container: getContainer }\"\n        @page-change=\"rehandlePageChange\"\n        @change=\"rehandleChange\"\n      >\n        <template #status=\"{ row }\">\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.FAIL\"\n            theme=\"danger\"\n            variant=\"light\"\n          >\n            审核失败\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.AUDIT_PENDING\"\n            theme=\"warning\"\n            variant=\"light\"\n          >\n            待审核\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.EXEC_PENDING\"\n            theme=\"warning\"\n            variant=\"light\"\n          >\n            待履行\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.EXECUTING\"\n            theme=\"success\"\n            variant=\"light\"\n          >\n            履行中\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.FINISH\"\n            theme=\"success\"\n            variant=\"light\"\n          >\n            已完成\n          </t-tag>\n        </template>\n        <template #contractType=\"{ row }\">\n          <p v-if=\"row.contractType === CONTRACT_TYPES.MAIN\">审核失败</p>\n          <p v-if=\"row.contractType === CONTRACT_TYPES.SUB\">待审核</p>\n          <p v-if=\"row.contractType === CONTRACT_TYPES.SUPPLEMENT\">待履行</p>\n        </template>\n        <template #paymentType=\"{ row }\">\n          <p\n            v-if=\"row.paymentType === CONTRACT_PAYMENT_TYPES.PAYMENT\"\n            class=\"payment-col\"\n          >\n            付款\n            <trend\n              class=\"dashboard-item-trend\"\n              type=\"up\"\n            />\n          </p>\n          <p\n            v-if=\"row.paymentType === CONTRACT_PAYMENT_TYPES.RECEIPT\"\n            class=\"payment-col\"\n          >\n            收款\n            <trend\n              class=\"dashboard-item-trend\"\n              type=\"down\"\n            />\n          </p>\n        </template>\n        <template #op=\"slotProps\">\n          <a\n            class=\"t-button-link\"\n            @click=\"rehandleClickOp(slotProps)\"\n          >\n            管理\n          </a>\n          <a\n            class=\"t-button-link\"\n            @click=\"handleClickDelete(slotProps)\"\n          >\n            删除\n          </a>\n        </template>\n      </t-table>\n      <t-dialog\n        v-model:visible=\"confirmVisible\"\n        header=\"确认删除当前所选合同？\"\n        :body=\"confirmBody\"\n        :on-cancel=\"onCancel\"\n        @confirm=\"onConfirmDelete\"\n      />\n    </div>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue';\nimport { MessagePlugin } from 'tdesign-vue-next';\nimport Trend from '@/components/trend/index.vue';\nimport { getList } from '@/api/list';\nimport { useSettingStore } from '@/store';\nimport { prefix } from '@/config/global';\n\nimport {\n  CONTRACT_STATUS,\n  CONTRACT_STATUS_OPTIONS,\n  CONTRACT_TYPES,\n  CONTRACT_TYPE_OPTIONS,\n  CONTRACT_PAYMENT_TYPES\n} from '@/enums';\n\nconst store = useSettingStore();\n\nconst COLUMNS = [\n  {\n    title: '合同名称',\n    fixed: 'left',\n    width: 200,\n    ellipsis: true,\n    align: 'left',\n    colKey: 'name'\n  },\n  { title: '合同状态', colKey: 'status', width: 200, cell: { col: 'status' } },\n  {\n    title: '合同编号',\n    width: 200,\n    ellipsis: true,\n    colKey: 'no'\n  },\n  {\n    title: '合同类型',\n    width: 200,\n    ellipsis: true,\n    colKey: 'contractType'\n  },\n  {\n    title: '合同收付类型',\n    width: 200,\n    ellipsis: true,\n    colKey: 'paymentType'\n  },\n  {\n    title: '合同金额 (元)',\n    width: 200,\n    ellipsis: true,\n    colKey: 'amount'\n  },\n  {\n    align: 'left',\n    fixed: 'right',\n    width: 200,\n    colKey: 'op',\n    title: '操作'\n  }\n];\n\nconst searchForm = {\n  name: '',\n  no: undefined,\n  status: undefined,\n  type: ''\n};\n\nconst formData = ref({ ...searchForm });\nconst rowKey = 'index';\nconst verticalAlign = 'top';\nconst hover = true;\n\nconst pagination = ref({\n  defaultPageSize: 20,\n  total: 100,\n  defaultCurrent: 1\n});\nconst confirmVisible = ref(false);\n\nconst data = ref([]);\n\nconst dataLoading = ref(false);\nconst fetchData = async () => {\n  dataLoading.value = true;\n  try {\n    const { list } = await getList();\n    data.value = list;\n    pagination.value = {\n      ...pagination.value,\n      total: list.length\n    };\n  } catch (e) {\n    console.log(e);\n  } finally {\n    dataLoading.value = false;\n  }\n};\n\nconst deleteIdx = ref(-1);\nconst confirmBody = computed(() => {\n  if (deleteIdx.value > -1) {\n    const { name } = data.value[deleteIdx.value];\n    return `删除后，${name}的所有合同信息将被清空，且无法恢复`;\n  }\n  return '';\n});\n\nconst resetIdx = () => {\n  deleteIdx.value = -1;\n};\n\nconst onConfirmDelete = () => {\n  // 真实业务请发起请求\n  data.value.splice(deleteIdx.value, 1);\n  pagination.value.total = data.value.length;\n  confirmVisible.value = false;\n  MessagePlugin.success('删除成功');\n  resetIdx();\n};\n\nconst onCancel = () => {\n  resetIdx();\n};\n\nonMounted(() => {\n  fetchData();\n});\n\nconst handleClickDelete = ({ row }) => {\n  deleteIdx.value = row.rowIndex;\n  confirmVisible.value = true;\n};\nconst onReset = val => {\n  console.log(val);\n};\nconst onSubmit = val => {\n  console.log(val);\n};\nconst rehandlePageChange = (curr, pageInfo) => {\n  console.log('分页变化', curr, pageInfo);\n};\nconst rehandleChange = (changeParams, triggerAndData) => {\n  console.log('统一Change', changeParams, triggerAndData);\n};\nconst rehandleClickOp = ({ text, row }) => {\n  console.log(text, row);\n};\n\nconst offsetTop = computed(() => {\n  return store.isUseTabsRouter ? 48 : 0;\n});\n\nconst getContainer = () => {\n  return document.querySelector(`.${prefix}-layout`);\n};\n</script>\n\n<style lang=\"less\" scoped>\n.list-common-table {\n  padding: 30px 32px;\n  background-color: var(--td-bg-color-container);\n  border-radius: @border-radius;\n  .table-container {\n    margin-top: 30px;\n  }\n}\n.form-item-content {\n  width: 100%;\n}\n.operation-container {\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n  .expand {\n    .t-button__text {\n      display: flex;\n      align-items: center;\n    }\n    .t-icon {\n      margin-left: 4px;\n      transition: transform 0.3s ease;\n    }\n  }\n}\n.payment-col {\n  display: flex;\n  .trend-container {\n    display: flex;\n    align-items: center;\n    margin-left: 8px;\n  }\n}\n</style>\n"],"names":["store","useSettingStore","COLUMNS","title","fixed","width","ellipsis","align","colKey","cell","col","formData","ref","__spreadValues","name","no","status","type","pagination","defaultPageSize","total","defaultCurrent","confirmVisible","data","dataLoading","fetchData","__async","this","value","list","getList","length","e","deleteIdx","confirmBody","computed","resetIdx","onConfirmDelete","splice","MessagePlugin","success","onCancel","onMounted","onReset","val","onSubmit","rehandlePageChange","curr","pageInfo","rehandleChange","changeParams","triggerAndData","offsetTop","isUseTabsRouter","getContainer","document","querySelector","prefix","row","rowIndex"],"mappings":"8/BAmNA,MAAAA,EAAAC,IAEAC,EAAA,CAAgB,CACdC,MAAA,OACSC,MAAA,OACAC,MAAA,IACAC,UAAA,EACGC,MAAA,OACHC,OAAA,QAET,CAAAL,MAAA,OAAAK,OAAA,SAAAH,MAAA,IAAAI,KAAA,CAAAC,IAAA,WACuE,CACvEP,MAAA,OACSE,MAAA,IACAC,UAAA,EACGE,OAAA,MAEZ,CACAL,MAAA,OACSE,MAAA,IACAC,UAAA,EACGE,OAAA,gBAEZ,CACAL,MAAA,SACSE,MAAA,IACAC,UAAA,EACGE,OAAA,eAEZ,CACAL,MAAA,WACSE,MAAA,IACAC,UAAA,EACGE,OAAA,UAEZ,CACAD,MAAA,OACSH,MAAA,QACAC,MAAA,IACAG,OAAA,KACCL,MAAA,OAYZQ,EAAAC,EAAAC,EAAA,GAPA,CAAmBC,KAAA,GACXC,QAAA,EACFC,YAAA,EACIC,KAAA,MASVC,EAAAN,EAAA,CAAuBO,gBAAA,GACJC,MAAA,IACVC,eAAA,IAGTC,EAAAV,GAAA,GAEAW,EAAAX,EAAA,IAEAY,EAAAZ,GAAA,GACAa,EAAA,KAAAC,SAAAC,OAAA,OAAA,YACEH,EAAAI,OAAA,EACA,IACE,MAAAC,KAAAA,SAAAC,IACAP,EAAAK,MAAAC,EACAX,EAAAU,SAAmBf,EAAA,GAAAK,EAAAU,SAAnB,CACgBR,MAAAS,EAAAE,yBAEhBC,IAEa,QAEbR,EAAAI,OAAA,oNAIJK,EAAArB,GAAA,GACAsB,GAAAC,EAAA,KACE,GAAAF,EAAAL,OAAA,EAAA,CACE,MAAAd,KAAAA,GAAAS,EAAAK,MAAAK,EAAAL,OACA,MAAA,OAAAd,qBAEF,MAAA,KAGFsB,GAAA,KACEH,EAAAL,OAAA,GAGFS,GAAA,KAEEd,EAAAK,MAAAU,OAAAL,EAAAL,MAAA,GACAV,EAAAU,MAAAR,MAAAG,EAAAK,MAAAG,OACAT,EAAAM,OAAA,EACAW,EAAAC,QAAA,cAIFC,GAAA,WAIAC,EAAA,WAIA,MAIAC,GAAAC,MAGAC,GAAAD,MAGAE,GAAA,CAAAC,EAAAC,OAGAC,GAAA,CAAAC,EAAAC,OAOAC,GAAAjB,EAAA,IACEnC,EAAAqD,gBAAA,GAAA,GAGFC,GAAA,IACEC,SAAAC,cAAA,IAAAC,yuDArFF,yBACA,aACA,g0CA0DA,GAAAC,IAAAA,MACEzB,EAAAL,MAAA8B,EAAAC,SACArC,EAAAM,OAAA"}