{"version":3,"file":"index-1c3862c1.js","sources":["../../../src/pages/list/base/constants.ts","../../../src/pages/list/base/index.vue"],"sourcesContent":["export const COLUMNS = [\n  { colKey: 'row-select', type: 'multiple', width: 64, fixed: 'left' },\n  {\n    title: '合同名称',\n    align: 'left',\n    width: 300,\n    colKey: 'name',\n    fixed: 'left'\n  },\n  { title: '合同状态', colKey: 'status', width: 200, cell: { col: 'status' } },\n  {\n    title: '合同编号',\n    width: 200,\n    ellipsis: true,\n    colKey: 'no'\n  },\n  {\n    title: '合同类型',\n    width: 200,\n    ellipsis: true,\n    colKey: 'contractType'\n  },\n  {\n    title: '合同收付类型',\n    width: 200,\n    ellipsis: true,\n    colKey: 'paymentType'\n  },\n  {\n    title: '合同金额 (元)',\n    width: 200,\n    ellipsis: true,\n    colKey: 'amount'\n  },\n  {\n    align: 'left',\n    fixed: 'right',\n    width: 200,\n    colKey: 'op',\n    title: '操作'\n  }\n];\n","<template>\n  <div>\n    <t-card class=\"list-card-container\">\n      <t-row justify=\"space-between\">\n        <div class=\"left-operation-container\">\n          <t-button @click=\"handleSetupContract\">新建合同</t-button>\n          <t-button\n            variant=\"base\"\n            theme=\"default\"\n            :disabled=\"!selectedRowKeys.length\"\n          >\n            导出合同\n          </t-button>\n          <p\n            v-if=\"!!selectedRowKeys.length\"\n            class=\"selected-count\"\n          >\n            已选{{ selectedRowKeys.length }}项\n          </p>\n        </div>\n        <div class=\"search-input\">\n          <t-input\n            v-model=\"searchValue\"\n            placeholder=\"请输入你需要搜索的内容\"\n            clearable\n          >\n            <template #suffix-icon>\n              <search-icon size=\"20px\" />\n            </template>\n          </t-input>\n        </div>\n      </t-row>\n      <t-table\n        :data=\"data\"\n        :columns=\"COLUMNS\"\n        :row-key=\"rowKey\"\n        vertical-align=\"top\"\n        :hover=\"true\"\n        :pagination=\"pagination\"\n        :selected-row-keys=\"selectedRowKeys\"\n        :loading=\"dataLoading\"\n        :header-affixed-top=\"{ offsetTop, container: getContainer }\"\n        @page-change=\"rehandlePageChange\"\n        @change=\"rehandleChange\"\n        @select-change=\"rehandleSelectChange\"\n      >\n        <template #status=\"{ row }\">\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.FAIL\"\n            theme=\"danger\"\n            variant=\"light\"\n          >\n            审核失败\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.AUDIT_PENDING\"\n            theme=\"warning\"\n            variant=\"light\"\n          >\n            待审核\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.EXEC_PENDING\"\n            theme=\"warning\"\n            variant=\"light\"\n          >\n            待履行\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.EXECUTING\"\n            theme=\"success\"\n            variant=\"light\"\n          >\n            履行中\n          </t-tag>\n          <t-tag\n            v-if=\"row.status === CONTRACT_STATUS.FINISH\"\n            theme=\"success\"\n            variant=\"light\"\n          >\n            已完成\n          </t-tag>\n        </template>\n        <template #contractType=\"{ row }\">\n          <p v-if=\"row.contractType === CONTRACT_TYPES.MAIN\">审核失败</p>\n          <p v-if=\"row.contractType === CONTRACT_TYPES.SUB\">待审核</p>\n          <p v-if=\"row.contractType === CONTRACT_TYPES.SUPPLEMENT\">待履行</p>\n        </template>\n        <template #paymentType=\"{ row }\">\n          <div\n            v-if=\"row.paymentType === CONTRACT_PAYMENT_TYPES.PAYMENT\"\n            class=\"payment-col\"\n          >\n            付款\n            <trend\n              class=\"dashboard-item-trend\"\n              type=\"up\"\n            />\n          </div>\n          <div\n            v-if=\"row.paymentType === CONTRACT_PAYMENT_TYPES.RECEIPT\"\n            class=\"payment-col\"\n          >\n            收款\n            <trend\n              class=\"dashboard-item-trend\"\n              type=\"down\"\n            />\n          </div>\n        </template>\n\n        <template #op=\"slotProps\">\n          <a\n            class=\"t-button-link\"\n            @click=\"handleClickDetail()\"\n          >\n            详情\n          </a>\n          <a\n            class=\"t-button-link\"\n            @click=\"handleClickDelete(slotProps)\"\n          >\n            删除\n          </a>\n        </template>\n      </t-table>\n    </t-card>\n\n    <t-dialog\n      v-model:visible=\"confirmVisible\"\n      header=\"确认删除当前所选合同？\"\n      :body=\"confirmBody\"\n      :on-cancel=\"onCancel\"\n      @confirm=\"onConfirmDelete\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'ListBase'\n};\n</script>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, computed } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { SearchIcon } from 'tdesign-icons-vue-next';\nimport { MessagePlugin } from 'tdesign-vue-next';\n\nimport {\n  CONTRACT_STATUS,\n  CONTRACT_TYPES,\n  CONTRACT_PAYMENT_TYPES\n} from '@/enums/index';\nimport Trend from '@/components/trend/index.vue';\nimport { getList } from '@/api/list';\nimport { useSettingStore } from '@/store';\nimport { prefix } from '@/config/global';\n\nimport { COLUMNS } from './constants';\n\nconst store = useSettingStore();\n\nconst data = ref([]);\nconst pagination = ref({\n  defaultPageSize: 20,\n  total: 100,\n  defaultCurrent: 1\n});\n\nconst searchValue = ref('');\n\nconst dataLoading = ref(false);\nconst fetchData = async () => {\n  dataLoading.value = true;\n  try {\n    const { list } = await getList();\n    data.value = list;\n    pagination.value = {\n      ...pagination.value,\n      total: list.length\n    };\n  } catch (e) {\n    console.log(e);\n  } finally {\n    dataLoading.value = false;\n  }\n};\n\nconst deleteIdx = ref(-1);\nconst confirmBody = computed(() => {\n  if (deleteIdx.value > -1) {\n    const { name } = data.value[deleteIdx.value];\n    return `删除后，${name}的所有合同信息将被清空，且无法恢复`;\n  }\n  return '';\n});\n\nonMounted(() => {\n  fetchData();\n});\n\nconst confirmVisible = ref(false);\n\nconst selectedRowKeys = ref([1, 2]);\n\nconst router = useRouter();\n\nconst resetIdx = () => {\n  deleteIdx.value = -1;\n};\n\nconst onConfirmDelete = () => {\n  // 真实业务请发起请求\n  data.value.splice(deleteIdx.value, 1);\n  pagination.value.total = data.value.length;\n  const selectedIdx = selectedRowKeys.value.indexOf(deleteIdx.value);\n  if (selectedIdx > -1) {\n    selectedRowKeys.value.splice(selectedIdx, 1);\n  }\n  confirmVisible.value = false;\n  MessagePlugin.success('删除成功');\n  resetIdx();\n};\n\nconst onCancel = () => {\n  resetIdx();\n};\n\nconst rowKey = 'index';\n\nconst rehandleSelectChange = (val: number[]) => {\n  selectedRowKeys.value = val;\n};\nconst rehandlePageChange = (curr, pageInfo) => {\n  console.log('分页变化', curr, pageInfo);\n};\nconst rehandleChange = (changeParams, triggerAndData) => {\n  console.log('统一Change', changeParams, triggerAndData);\n};\nconst handleClickDetail = () => {\n  router.push('/detail/base');\n};\nconst handleSetupContract = () => {\n  router.push('/form/base');\n};\nconst handleClickDelete = (row: { rowIndex: any }) => {\n  deleteIdx.value = row.rowIndex;\n  confirmVisible.value = true;\n};\n\nconst offsetTop = computed(() => {\n  return store.isUseTabsRouter ? 48 : 0;\n});\n\nconst getContainer = () => {\n  return document.querySelector(`.${prefix}-layout`);\n};\n</script>\n\n<style lang=\"less\" scoped>\n.payment-col {\n  display: flex;\n  .trend-container {\n    display: flex;\n    align-items: center;\n    margin-left: 8px;\n  }\n}\n.left-operation-container {\n  padding: 6px 0;\n  margin-bottom: 16px;\n  .selected-count {\n    display: inline-block;\n    margin-left: 8px;\n    color: var(--td-text-color-secondary);\n  }\n}\n.search-input {\n  width: 360px;\n}\n</style>\n"],"names":["COLUMNS","colKey","type","width","fixed","title","align","cell","col","ellipsis","name","store","useSettingStore","data","ref","pagination","defaultPageSize","total","defaultCurrent","searchValue","dataLoading","fetchData","__async","this","value","list","getList","__spreadProps","__spreadValues","length","e","deleteIdx","confirmBody","computed","onMounted","confirmVisible","selectedRowKeys","router","useRouter","resetIdx","onConfirmDelete","splice","selectedIdx","indexOf","MessagePlugin","success","onCancel","rehandleSelectChange","val","rehandlePageChange","curr","pageInfo","rehandleChange","changeParams","triggerAndData","handleSetupContract","push","offsetTop","isUseTabsRouter","getContainer","document","querySelector","prefix","row","rowIndex"],"mappings":"w5BAAO,MAAMA,EAAU,CACrB,CAAEC,OAAQ,aAAcC,KAAM,WAAYC,MAAO,GAAIC,MAAO,QAC5D,CACEC,MAAO,OACPC,MAAO,OACPH,MAAO,IACPF,OAAQ,OACRG,MAAO,QAET,CAAEC,MAAO,OAAQJ,OAAQ,SAAUE,MAAO,IAAKI,KAAM,CAAEC,IAAK,WAC5D,CACEH,MAAO,OACPF,MAAO,IACPM,UAAU,EACVR,OAAQ,MAEV,CACEI,MAAO,OACPF,MAAO,IACPM,UAAU,EACVR,OAAQ,gBAEV,CACEI,MAAO,SACPF,MAAO,IACPM,UAAU,EACVR,OAAQ,eAEV,CACEI,MAAO,WACPF,MAAO,IACPM,UAAU,EACVR,OAAQ,UAEV,CACEK,MAAO,OACPF,MAAO,QACPD,MAAO,IACPF,OAAQ,KACRI,MAAO,2NCoGX,CAAeK,KAAA,uBAuBf,MAAAC,EAAAC,IAEAC,EAAAC,EAAA,IACAC,EAAAD,EAAA,CAAuBE,gBAAA,GACJC,MAAA,IACVC,eAAA,IAITC,EAAAL,EAAA,IAEAM,EAAAN,GAAA,GACAO,EAAA,KAAAC,SAAAC,OAAA,OAAA,YACEH,EAAAI,OAAA,EACA,IACE,MAAAC,KAAAA,SAAAC,IACAb,EAAAW,MAAAC,EACAV,EAAAS,MAAAG,EAAmBC,EAAA,GAAAb,EAAAS,OAAnB,CACgBP,MAAAQ,EAAAI,eAEhBC,IAEa,QAEbV,EAAAI,OAAA,6MAIJO,EAAAjB,GAAA,GACAkB,EAAAC,EAAA,KACE,GAAAF,EAAAP,OAAA,EAAA,CACE,MAAAd,KAAAA,GAAAG,EAAAW,MAAAO,EAAAP,OACA,MAAA,OAAAd,qBAEF,MAAA,KAGFwB,EAAA,WAIA,MAAAC,EAAArB,GAAA,GAEAsB,EAAAtB,EAAA,CAAA,EAAA,IAEAuB,EAAAC,IAEAC,GAAA,KACER,EAAAP,OAAA,GAGFgB,GAAA,KAEE3B,EAAAW,MAAAiB,OAAAV,EAAAP,MAAA,GACAT,EAAAS,MAAAP,MAAAJ,EAAAW,MAAAK,OACA,MAAAa,EAAAN,EAAAZ,MAAAmB,QAAAZ,EAAAP,OACAkB,GAAA,GACEN,EAAAZ,MAAAiB,OAAAC,EAAA,GAEFP,EAAAX,OAAA,EACAoB,EAAAC,QAAA,cAIFC,GAAA,WAMAC,GAAAC,IACEZ,EAAAZ,MAAAwB,GAEFC,GAAA,CAAAC,EAAAC,OAGAC,GAAA,CAAAC,EAAAC,OAMAC,GAAA,KACElB,EAAAmB,KAAA,eAOFC,GAAAxB,EAAA,IACEtB,EAAA+C,gBAAA,GAAA,GAGFC,GAAA,IACEC,SAAAC,cAAA,IAAAC,+pBA3BF,q0CAYEzB,EAAAmB,KAAA,2EAKFO,IACEhC,EAAAP,MAAAuC,EAAAC,cACA7B,EAAAX,OAAA,GAFF,IAAAuC"}