var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,i=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&a(e,r,t[r]);if(s)for(var r of s(t))n.call(t,r)&&a(e,r,t[r]);return e},c=(e,s)=>t(e,r(s)),u=(e,t,r)=>(a(e,"symbol"!=typeof t?t+"":t,r),r);import{af as p,b1 as l,b2 as h,b3 as d,b4 as m,b5 as f,M as g,b6 as v}from"./.pnpm-23496a1a.js";const T="tdesign-starter",w="tdesign-starter",y={calendar:{},table:{},pagination:{}},b={calendar:{},table:{},pagination:{}};let q=new Map;const O=e=>[e.method,e.url].join("&");class P{addPending(e){this.removePending(e);const t=O(e);e.cancelToken=e.cancelToken||new p.CancelToken(e=>{q.has(t)||q.set(t,e)})}removeAllPending(){q.forEach(e=>{e&&l(e)&&e()}),q.clear()}removePending(e){const t=O(e);if(q.has(t)){const e=q.get(t);e&&e(t),q.delete(t)}}reset(){q=new Map}}class E{constructor(e){u(this,"instance"),u(this,"options"),this.options=e,this.instance=p.create(e),this.setupInterceptors()}createAxios(e){this.instance=p.create(e)}getTransform(){const{transform:e}=this.options;return e}getAxios(){return this.instance}configAxios(e){this.instance&&this.createAxios(e)}setHeader(e){this.instance&&Object.assign(this.instance.defaults.headers,e)}setupInterceptors(){const e=this.getTransform();if(!e)return;const{requestInterceptors:t,requestInterceptorsCatch:r,responseInterceptors:s,responseInterceptorsCatch:o}=e,n=new P;this.instance.interceptors.request.use(e=>{var r;const{headers:{ignoreRepeatRequest:s}}=e;return(null!=s?s:null==(r=this.options.requestOptions)?void 0:r.ignoreRepeatRequest)||n.addPending(e),t&&l(t)&&(e=t(e,this.options)),e},void 0),r&&l(r)&&this.instance.interceptors.request.use(void 0,r),this.instance.interceptors.response.use(e=>(e&&n.removePending(e.config),s&&l(s)&&(e=s(e)),e),void 0),o&&l(o)&&this.instance.interceptors.response.use(void 0,o)}supportFormData(e){var t;const r=e.headers||this.options.headers;return"application/x-www-form-urlencoded;charset=UTF-8"===((null==r?void 0:r["Content-Type"])||(null==r?void 0:r["content-type"]))&&Reflect.has(e,"data")&&"GET"!==(null==(t=e.method)?void 0:t.toUpperCase())?c(i({},e),{data:h.stringify(e.data,{arrayFormat:"brackets"})}):e}get(e,t){return this.request(c(i({},e),{method:"GET"}),t)}post(e,t){return this.request(c(i({},e),{method:"POST"}),t)}put(e,t){return this.request(c(i({},e),{method:"PUT"}),t)}delete(e,t){return this.request(c(i({},e),{method:"DELETE"}),t)}patch(e,t){return this.request(c(i({},e),{method:"PATCH"}),t)}request(e,t){return r=this,s=null,o=function*(){let r=d(e);const s=this.getTransform(),{requestOptions:o}=this.options,n=i(i({},o),t),{beforeRequestHook:a,requestCatchHook:c,transformRequestHook:u}=s||{};return a&&l(a)&&(r=a(r,n)),r.requestOptions=n,r=this.supportFormData(r),new Promise((t,s)=>{this.instance.request(e.retryCount?e:r).then(e=>{if(u&&l(u))try{const r=u(e,n);t(r)}catch(r){s(r||new Error("请求错误!"))}else t(e)}).catch(e=>{c&&l(c)?s(c(e,n)):(p.isAxiosError(e),s(e))})})},new Promise((e,t)=>{var n=e=>{try{i(o.next(e))}catch(r){t(r)}},a=e=>{try{i(o.throw(e))}catch(r){t(r)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,a);i((o=o.apply(r,s)).next())});var r,s,o}}function C(e,t=!1){if(!e)return t?"":{};const r=(new Date).getTime();return t?"?_t="+r:{_t:r}}function j(e){if("[object Object]"===Object.prototype.toString.call(e))for(const r in e){if(e[r]&&e[r]._isAMomentObject&&(e[r]=e[r].format("YYYY-MM-DD HH:mm:ss")),m(r)){const s=e[r];if(s)try{e[r]=m(s)?s.trim():s}catch(t){throw new Error(t)}}f(e[r])&&j(e[r])}}const R={400:"错误请求!",401:"登录失效，请尝试重新登录!",403:"暂无该操作权限",404:"资源不存在",500:"服务异常",NetworkError:"网络异常，请检查您的网络连接是否正常!",TimeoutError:"请求超时，请刷新页面重试!",CancelToken:"请求已取消"};const k=new E(v({authenticationScheme:"",timeout:1e4,withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},transform:{transformRequestHook:(e,t)=>{var r;const{isTransformResponse:s,isReturnNativeResponse:o}=t,n=null==(r=e.config.method)?void 0:r.toLowerCase();if(204===e.status||"put"===n||"patch"===n)return e;if(o)return e;if(!s)return e.data;const{data:a}=e;if(!a)throw new Error("请求接口错误");const{code:i,msg:c}=a;if(a&&0===i)return a.data;throw new Error(`请求接口错误, 错误码: ${i}, 错误信息: ${c}`)},beforeRequestHook:(e,t)=>{var r;const{apiUrl:s,isJoinPrefix:o,urlPrefix:n,joinParamsToUrl:a,formatDate:c,joinTime:u=!0}=t;o&&n&&m(n)&&(e.url=`${n}${e.url}`),s&&m(s)&&(e.url=`${s}${e.url}`);const p=e.params||{},l=e.data||!1;return c&&l&&!m(l)&&j(l),"GET"===(null==(r=e.method)?void 0:r.toUpperCase())?m(p)?(e.url=`${e.url+p}${C(u,!0)}`,e.params=void 0):e.params=Object.assign(p||{},C(u,!1)):m(p)?(e.url+=p,e.params=void 0):(c&&j(p),Reflect.has(e,"data")&&e.data&&(Object.keys(e.data).length>0||l instanceof FormData)?(e.data=l,e.params=p):(e.data=p,e.params=void 0),a&&(e.url=function(e,t){let r="";for(const s in t)r+=`${s}=${encodeURIComponent(t[s])}&`;return r=r.replace(/&$/,""),/\?$/.test(e)?e+r:e.replace(/\/?$/,"?")+r}(e.url,i(i({},e.params),e.data)))),e},requestInterceptors:(e,t)=>{var r;const s=localStorage.getItem("tdesign-starter");return s&&!1!==(null==(r=null==e?void 0:e.requestOptions)?void 0:r.withToken)&&(e.headers.Authorization=t.authenticationScheme?`${t.authenticationScheme} ${s}`:s),e},responseInterceptors:e=>e,responseInterceptorsCatch:e=>{const{config:t}=e;if(function(e){var t;let r;const{response:s,message:o,code:n,config:a}=e||{};"ECONNABORTED"===n&&-1!==o.indexOf("timeout")&&(e.message=R.TimeoutError,r="TimeoutError"),"Network Error"===o&&(e.message=R.NetworkError,r="NetworkError"),R[null==s?void 0:s.status]&&(e.message=R[null==s?void 0:s.status],r=null==s?void 0:s.status),p.isCancel(e)&&(e.message=R.CancelToken,r="CancelToken"),(null==(t=null==a?void 0:a.requestOptions)?void 0:t.showErrorMessage)&&(g.closeAll(),g.error(`接口异常：${r} - ${e.message}`))}(e),!t||!t.requestOptions.retry)return Promise.reject(e);if(t.retryCount=t.retryCount||0,t.retryCount>=t.requestOptions.retry.count)return Promise.reject(e);t.retryCount+=1;return new Promise(e=>{setTimeout(()=>{e(t)},t.requestOptions.retry.delay||1)}).then(e=>k.request(e))}},requestOptions:{isJoinPrefix:!0,isReturnNativeResponse:!1,isTransformResponse:!0,joinParamsToUrl:!1,formatDate:!0,joinTime:!0,ignoreRepeatRequest:!0,withToken:!0,retry:{count:3,delay:1e3},showErrorMessage:!0}},$||{}));var $;export{P as A,w as T,b as a,y as g,T as p,k as r};
//# sourceMappingURL=index-cf7ca57d.js.map
