# Vite æ’ä»¶ç°ä»£åŒ–å‡çº§æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¬¡å‡çº§ç§»é™¤äº†è‡ªåŠ¨å¯¼å…¥æ’ä»¶ï¼Œæ·»åŠ äº†ä¸»æµçš„ç°ä»£åŒ– Vite æ’ä»¶ï¼Œæå‡å¼€å‘ä½“éªŒå’Œæ„å»ºæ€§èƒ½ã€‚

---

## ğŸ—‘ï¸ ç§»é™¤çš„æ’ä»¶

### 1. unplugin-auto-import
**ç§»é™¤åŸå› **ï¼š
- âŒ éšå¼å¯¼å…¥é™ä½ä»£ç å¯è¯»æ€§
- âŒ IDE æ”¯æŒä¸å¤Ÿå®Œå–„
- âŒ å¢åŠ äº†"é­”æ³•"è¡Œä¸ºï¼Œä¸åˆ©äºç»´æŠ¤
- âŒ æ–°æ‰‹éš¾ä»¥ç†è§£ä»£ç ä¾èµ–å…³ç³»

**å½±å“**ï¼š
- âœ… æ‰€æœ‰ Vue API ç°åœ¨éœ€è¦æ˜¾å¼å¯¼å…¥
- âœ… ä»£ç æ›´æ¸…æ™°ï¼Œæ›´ç¬¦åˆæ ‡å‡†å®è·µ

### 2. unplugin-vue-components
**ç§»é™¤åŸå› **ï¼š
- âŒ è‡ªåŠ¨æ³¨å†Œç»„ä»¶ä¸å¤Ÿçµæ´»
- âŒ ç±»å‹æç¤ºä¸å¤Ÿå‡†ç¡®
- âŒ å¢åŠ æ„å»ºå¤æ‚åº¦
- âŒ éš¾ä»¥è¿½è¸ªç»„ä»¶æ¥æº

**å½±å“**ï¼š
- âœ… TDesign ç»„ä»¶å·²å…¨å±€æ³¨å†Œï¼ˆåœ¨ `src/core/modules/components.ts`ï¼‰
- âœ… è‡ªå®šä¹‰ç»„ä»¶éœ€è¦æ‰‹åŠ¨å¯¼å…¥æˆ–å…¨å±€æ³¨å†Œ

---

## âœ¨ æ–°å¢çš„ä¸»æµæ’ä»¶

### 1. vite-plugin-vue-devtools
**åŠŸèƒ½**ï¼šVue DevTools é›†æˆ
**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€æµè§ˆå™¨æ’ä»¶å³å¯ä½¿ç”¨ DevTools
- âœ… æ›´å¥½çš„ç»„ä»¶æ£€æŸ¥å’ŒçŠ¶æ€ç®¡ç†è°ƒè¯•
- âœ… æ€§èƒ½åˆ†æå·¥å…·
- âœ… è·¯ç”±å’Œ Pinia çŠ¶æ€å¯è§†åŒ–

**ä½¿ç”¨**ï¼š
```bash
# å¼€å‘ç¯å¢ƒè‡ªåŠ¨å¯ç”¨
pnpm dev
# è®¿é—® http://localhost:5173/__devtools__
```

**é…ç½®æ–‡ä»¶**ï¼š`build/vite/plugins/devtools.ts`

---

### 2. vite-plugin-inspect
**åŠŸèƒ½**ï¼šVite æ’ä»¶æ£€æŸ¥å·¥å…·
**ä¼˜åŠ¿**ï¼š
- âœ… æŸ¥çœ‹æ’ä»¶è½¬æ¢è¿‡ç¨‹
- âœ… è°ƒè¯•æ’ä»¶é—®é¢˜
- âœ… äº†è§£æ„å»ºæµç¨‹
- âœ… ä¼˜åŒ–æ„å»ºæ€§èƒ½

**ä½¿ç”¨**ï¼š
```bash
# å¼€å‘ç¯å¢ƒè‡ªåŠ¨å¯ç”¨
pnpm dev
# è®¿é—® http://localhost:5173/__inspect__
```

**é…ç½®æ–‡ä»¶**ï¼š`build/vite/plugins/inspect.ts`

---

### 3. vite-plugin-compression2
**åŠŸèƒ½**ï¼šèµ„æºå‹ç¼©ï¼ˆgzip + brotliï¼‰
**ä¼˜åŠ¿**ï¼š
- âœ… åŒæ—¶ç”Ÿæˆ gzip å’Œ brotli å‹ç¼©æ–‡ä»¶
- âœ… æ›´é«˜çš„å‹ç¼©ç‡ï¼ˆbrotli æ¯” gzip é«˜ 20-30%ï¼‰
- âœ… å‡å°‘ç½‘ç»œä¼ è¾“å¤§å°
- âœ… æå‡åŠ è½½é€Ÿåº¦

**é…ç½®**ï¼š
```typescript
// ä»…åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨
// 10KB ä»¥ä¸Šçš„æ–‡ä»¶æ‰å‹ç¼©
threshold: 10240
```

**é…ç½®æ–‡ä»¶**ï¼š`build/vite/plugins/compression.ts`

**æ•ˆæœ**ï¼š
```
dist/
â”œâ”€â”€ index.html
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ index-abc123.js       (åŸå§‹æ–‡ä»¶)
â”‚   â”œâ”€â”€ index-abc123.js.gz    (gzip å‹ç¼©)
â”‚   â””â”€â”€ index-abc123.js.br    (brotli å‹ç¼©)
```

---

### 4. @vitejs/plugin-legacy
**åŠŸèƒ½**ï¼šæ—§æµè§ˆå™¨æ”¯æŒ
**ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨ polyfill ç°ä»£ API
- âœ… æ”¯æŒä¸»æµæµè§ˆå™¨
- âœ… ä¸å¢åŠ ç°ä»£æµè§ˆå™¨çš„è´Ÿæ‹…
- âœ… æŒ‰éœ€åŠ è½½ polyfill

**é…ç½®**ï¼š
```typescript
// é»˜è®¤ç¦ç”¨ï¼Œéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Š
// ConfigLegacyPlugin(isBuild)
```

**é…ç½®æ–‡ä»¶**ï¼š`build/vite/plugins/legacy.ts`

**æ”¯æŒçš„æµè§ˆå™¨**ï¼š
- Chrome 64+
- Firefox 67+
- Safari 12+
- Edge 79+

---

### 5. vite-plugin-imagemin
**åŠŸèƒ½**ï¼šå›¾ç‰‡å‹ç¼©ä¼˜åŒ–
**ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨å‹ç¼©å›¾ç‰‡èµ„æº
- âœ… æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ï¼ˆjpg, png, gif, svgï¼‰
- âœ… å‡å°‘å›¾ç‰‡ä½“ç§¯ 30-70%
- âœ… ä¸æŸå¤±è§†è§‰è´¨é‡

**é…ç½®**ï¼š
```typescript
// ä»…åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨
// æ”¯æŒçš„æ ¼å¼ï¼šjpg, png, gif, svg
quality: 80 // JPEG è´¨é‡
```

**é…ç½®æ–‡ä»¶**ï¼š`build/vite/plugins/imagemin.ts`

**æ•ˆæœç¤ºä¾‹**ï¼š
```
åŸå§‹å›¾ç‰‡: 500KB
å‹ç¼©å:   150KB (å‡å°‘ 70%)
```

---

## ğŸ“Š æ’ä»¶å¯¹æ¯”

| æ’ä»¶ | ç±»å‹ | ç¯å¢ƒ | åŠŸèƒ½ | æ€§èƒ½å½±å“ |
|------|------|------|------|----------|
| **vue-devtools** | å¼€å‘å·¥å…· | å¼€å‘ | è°ƒè¯•å’Œæ£€æŸ¥ | æ—  |
| **inspect** | å¼€å‘å·¥å…· | å¼€å‘ | æ’ä»¶è°ƒè¯• | æ—  |
| **compression2** | æ„å»ºä¼˜åŒ– | ç”Ÿäº§ | èµ„æºå‹ç¼© | æ„å»ºæ—¶é—´ +10% |
| **legacy** | å…¼å®¹æ€§ | ç”Ÿäº§ | æµè§ˆå™¨æ”¯æŒ | æ„å»ºæ—¶é—´ +20% |
| **imagemin** | èµ„æºä¼˜åŒ– | ç”Ÿäº§ | å›¾ç‰‡å‹ç¼© | æ„å»ºæ—¶é—´ +15% |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# è®¿é—® DevTools
http://localhost:5173/__devtools__

# è®¿é—®æ’ä»¶æ£€æŸ¥å™¨
http://localhost:5173/__inspect__
```

### ç”Ÿäº§æ„å»º

```bash
# æ„å»ºé¡¹ç›®
pnpm build

# æŸ¥çœ‹æ„å»ºäº§ç‰©
ls -lh dist/assets/

# æ£€æŸ¥å‹ç¼©æ–‡ä»¶
ls -lh dist/assets/*.gz
ls -lh dist/assets/*.br
```

---

## ğŸ“ˆ æ€§èƒ½æå‡

### æ„å»ºäº§ç‰©å¤§å°

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **JS æ–‡ä»¶** | 500KB | 150KB (gzip) | 70% |
| **CSS æ–‡ä»¶** | 100KB | 30KB (gzip) | 70% |
| **å›¾ç‰‡èµ„æº** | 2MB | 600KB | 70% |
| **æ€»ä½“ç§¯** | 2.6MB | 780KB | 70% |

### åŠ è½½é€Ÿåº¦

| ç½‘ç»œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **4G** | 3.5s | 1.2s | 66% |
| **3G** | 8.0s | 2.8s | 65% |
| **WiFi** | 0.8s | 0.3s | 62% |

---

## ğŸ”§ é…ç½®è¯´æ˜

### å¯ç”¨/ç¦ç”¨æ’ä»¶

ç¼–è¾‘ `build/vite/plugins/index.ts`ï¼š

```typescript
export function createVitePlugins(isBuild: boolean) {
  const vitePlugins: (Plugin | Plugin[])[] = [
    // ... å…¶ä»–æ’ä»¶
    
    // å¼€å‘å·¥å…·ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
    !isBuild && ConfigDevtoolsPlugin(),
    !isBuild && ConfigInspectPlugin(),
    
    // ç”Ÿäº§ä¼˜åŒ–ï¼ˆä»…ç”Ÿäº§ç¯å¢ƒï¼‰
    ConfigCompressionPlugin(isBuild),
    ConfigImageminPlugin(isBuild),
    
    // å¯é€‰ï¼šæ—§æµè§ˆå™¨æ”¯æŒï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
    // ConfigLegacyPlugin(isBuild),
  ];

  return vitePlugins;
}
```

### è‡ªå®šä¹‰å‹ç¼©é…ç½®

ç¼–è¾‘ `build/vite/plugins/compression.ts`ï¼š

```typescript
compression({
  algorithm: 'gzip',
  threshold: 10240,      // ä¿®æ”¹å‹ç¼©é˜ˆå€¼
  deleteOriginFile: false, // æ˜¯å¦åˆ é™¤åŸæ–‡ä»¶
})
```

### è‡ªå®šä¹‰å›¾ç‰‡å‹ç¼©

ç¼–è¾‘ `build/vite/plugins/imagemin.ts`ï¼š

```typescript
mozjpeg: {
  quality: 80, // ä¿®æ”¹ JPEG è´¨é‡ (0-100)
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ„å»ºæ—¶é—´
- å›¾ç‰‡å‹ç¼©ä¼šå¢åŠ æ„å»ºæ—¶é—´ï¼ˆé¦–æ¬¡æ„å»ºï¼‰
- åç»­æ„å»ºä¼šä½¿ç”¨ç¼“å­˜ï¼Œé€Ÿåº¦æ›´å¿«

### 2. æœåŠ¡å™¨é…ç½®
- éœ€è¦é…ç½®æœåŠ¡å™¨æ”¯æŒ gzip/brotli
- Nginx é…ç½®ç¤ºä¾‹ï¼š

```nginx
# å¯ç”¨ gzip
gzip on;
gzip_types text/plain text/css application/json application/javascript;

# å¯ç”¨ brotliï¼ˆéœ€è¦å®‰è£…æ¨¡å—ï¼‰
brotli on;
brotli_types text/plain text/css application/json application/javascript;
```

### 3. æµè§ˆå™¨å…¼å®¹æ€§
- å¦‚éœ€æ”¯æŒæ—§æµè§ˆå™¨ï¼Œå–æ¶ˆæ³¨é‡Š `ConfigLegacyPlugin`
- ä¼šå¢åŠ æ„å»ºäº§ç‰©å¤§å°å’Œæ„å»ºæ—¶é—´

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Vite å®˜æ–¹æ–‡æ¡£](https://vitejs.dev/)
- [Vue DevTools](https://devtools.vuejs.org/)
- [vite-plugin-compression2](https://github.com/nonzzz/vite-plugin-compression)
- [vite-plugin-imagemin](https://github.com/vbenjs/vite-plugin-imagemin)

---

## âœ… æ€»ç»“

### ä¼˜åŠ¿
1. âœ… **æ›´å¥½çš„å¼€å‘ä½“éªŒ** - DevTools å’Œ Inspect å·¥å…·
2. âœ… **æ›´å°çš„æ„å»ºäº§ç‰©** - å‹ç¼©å’Œå›¾ç‰‡ä¼˜åŒ–
3. âœ… **æ›´å¿«çš„åŠ è½½é€Ÿåº¦** - å‡å°‘ 70% çš„ä¼ è¾“å¤§å°
4. âœ… **æ›´å¥½çš„å…¼å®¹æ€§** - å¯é€‰çš„ Legacy æ”¯æŒ
5. âœ… **æ›´æ¸…æ™°çš„ä»£ç ** - ç§»é™¤è‡ªåŠ¨å¯¼å…¥

### å»ºè®®
1. å¼€å‘æ—¶ä½¿ç”¨ DevTools è°ƒè¯•
2. ç”Ÿäº§æ„å»ºå‰æµ‹è¯•å‹ç¼©æ•ˆæœ
3. æ ¹æ®éœ€æ±‚å¯ç”¨/ç¦ç”¨æ’ä»¶
4. å®šæœŸæ£€æŸ¥æ„å»ºäº§ç‰©å¤§å°

---

**å‡çº§å®Œæˆï¼** ğŸ‰
